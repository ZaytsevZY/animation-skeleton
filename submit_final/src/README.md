# 骨架绑定系统 - 使用说明

## 项目简介
这是一个完整的骨架绑定系统，实现了计算机动画中的骨架驱动三维模型运动功能。

## 功能特点

### 核心功能
- ✅ 三维模型加载与显示
- ✅ 骨架关节点创建与可视化
- ✅ 自动计算骨架与模型表面点的绑定权重
- ✅ 手动拖拽控制骨架运动
- ✅ 实时带动模型表面点变形
- ✅ 多种蒙皮模式切换（完整/简化）

### 导出功能
- 📋 导出骨架关节点位置信息
- ⚖️ 导出绑定权重信息
- 📁 导出完整的项目信息
- 💾 支持JSON格式数据导出

### 交互功能
- 🖱️ 鼠标点击选择关节
- 🎯 拖拽箭头沿轴移动关节
- 🔄 一键重置到初始状态
- 📊 实时显示操作状态

## 文件结构

```
submit/
├── src/
│   ├── main.py              # 主程序入口
│   ├── ui_simple.py         # 完整UI界面
│   ├── requirements.txt     # 依赖列表
│   ├── README.md           # 使用说明
│   ├── output/             # 导出文件目录
│   └── rigging/            # 核心功能模块
│       ├── __init__.py
│       ├── mesh_io.py      # 网格I/O处理
│       ├── skeleton.py     # 骨架定义
│       ├── skeleton_loader.py  # 骨架加载
│       ├── weights_nearest.py  # 权重计算
│       ├── weights_heat.py     # 热平衡权重
│       └── lbs.py          # 线性混合蒙皮
```

## 快速开始

### 1. 环境配置
```bash
# 安装依赖
pip install -r requirements.txt

# 或直接安装
pip install numpy PyQt5 pyvista pyvistaqt trimesh vtk
```

### 2. 运行程序
```bash
# 直接运行
python main.py

# 或双击main.py运行
```

### 3. 使用界面

#### 基本操作
1. **选择关节**：点击红色球体选择骨架关节
2. **移动关节**：拖拽黄色箭头沿轴移动
3. **重置状态**：点击左侧"重置到初始状态"按钮
4. **切换模式**：在"蒙皮设置"中选择完整或简化蒙皮

#### 导出数据
1. **导出骨架信息**：点击"导出骨架信息"按钮
2. **导出权重信息**：点击"导出绑定权重"按钮
3. **导出全部信息**：点击"导出全部信息"按钮

## 权重计算算法

### 1. 简化权重（最近关节法）
- 每个表面点只跟随最近的骨架关节
- 权重为0或1
- 计算快速，适合预览

### 2. 完整权重（多关节加权）
- 基于逆距离权重算法
- 考虑多个关节的影响
- 权重平滑过渡，变形质量高

## 导出文件格式

### 骨架信息文件 (skeleton_info_*.json)
```json
{
  "joints": [
    {
      "index": 0,
      "name": "joint_name",
      "parent": -1,
      "bind_position": [x, y, z],
      "current_position": [x, y, z],
      "transform": [[...], ...]
    }
  ],
  "bones": [
    {
      "parent_joint": 0,
      "child_joint": 1,
      "parent_name": "parent",
      "child_name": "child"
    }
  ]
}
```

### 权重信息文件 (weights_info_*.json)
```json
{
  "vertices": [...],
  "weights": {
    "full": [...],
    "simple": [...]
  }
}
```

## 技术规格

### 支持的模型格式
- GLB/GLTF格式（推荐使用）
- 包含网格和骨架信息

### 系统要求
- **操作系统**：Windows 10/11, macOS, Linux
- **Python版本**：3.7或更高
- **内存要求**：至少4GB RAM
- **显卡要求**：支持OpenGL 3.3或更高

## 常见问题

### Q: 程序启动失败怎么办？
A: 请检查是否安装了所有依赖项，运行`pip install -r requirements.txt`

### Q: 模型加载失败怎么办？
A: 确保模型是GLB格式，且包含有效的骨架信息

### Q: 导出文件在哪里？
A: 导出文件保存在`submit/src/output/`目录下

### Q: 如何创建自定义骨架？
A: 可以使用Blender创建骨架并导出为GLB格式

## 开发信息

- **课程**：计算机动画的算法与技术
- **作业**：骨架绑定大作业
- **作者**：学生作业
- **版本**：2.0
- **日期**：2025年

## 联系信息
如有问题请联系：1729406968@qq.com